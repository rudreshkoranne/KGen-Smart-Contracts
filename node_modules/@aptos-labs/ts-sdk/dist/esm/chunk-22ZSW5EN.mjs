import{a as h,c as sn,d as cn,e as R}from"./chunk-DMSHPWA5.mjs";import{r as on,u as A}from"./chunk-IFXUWUP2.mjs";import{a as an}from"./chunk-Y267I7DC.mjs";import{b as rn}from"./chunk-T5BCTWGK.mjs";import{a as en}from"./chunk-BVVHGSWC.mjs";import{a as y}from"./chunk-F2RY4YQ7.mjs";import{a as nn}from"./chunk-XQ7ONNII.mjs";import{a as tn}from"./chunk-RBJNSUSU.mjs";import{a as J,c as Q,d as Y}from"./chunk-4LKLOUMG.mjs";import{c as H,d as X,e as z,f as x,g as L,h as Z,i as j}from"./chunk-ZPIMARUG.mjs";import{a as q}from"./chunk-ZINOJTLU.mjs";import{b as B,d as F,e as D,f as M}from"./chunk-SGQFWWLQ.mjs";import{a as V,b as p,d as l,e as E}from"./chunk-MK2QAHXC.mjs";import{a as k,b as O}from"./chunk-6DMDYBV6.mjs";import{a as b,b as g}from"./chunk-TPJLAYW6.mjs";import{a as N}from"./chunk-4VU2ABLU.mjs";import{a as v}from"./chunk-BOWPP6YG.mjs";import{i as S,j as C}from"./chunk-FTZGP6XW.mjs";import{b as $,d as K}from"./chunk-P3J54CQG.mjs";import{a as _}from"./chunk-HBIDHQ2M.mjs";import{a as U}from"./chunk-4CDDWSKZ.mjs";import{g as I}from"./chunk-D3OEQLUE.mjs";import{b as W,c as G}from"./chunk-J245N3XF.mjs";import{b as u}from"./chunk-KM6UXNC7.mjs";import{b as P}from"./chunk-KFNDDPOW.mjs";import{sha3_256 as fn}from"@noble/hashes/sha3";async function qn(n){if(on(n))return ln(n);let{moduleAddress:e,moduleName:t,functionName:i}=A(n.function),a=await dn({key:"entry-function",moduleAddress:e,moduleName:t,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:sn});return gn({...n,abi:a})}function gn(n){let e=n.abi,{moduleAddress:t,moduleName:i,functionName:a}=A(n.function),r=h(n.typeArguments);if(r.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${r.length}`);let o=n.functionArguments.map((s,d)=>R(n.function,e,s,d,r));if(o.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${i}::${a}', expected ${e.parameters.length} but got ${o.length}`);let c=x.build(`${t}::${i}`,a,r,o);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new z(new Z(s,new j(c)))}return new X(c)}async function Hn(n){let{moduleAddress:e,moduleName:t,functionName:i}=A(n.function),a=await dn({key:"view-function",moduleAddress:e,moduleName:t,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:cn});return pn({abi:a,...n})}function pn(n){let e=n.abi,{moduleAddress:t,moduleName:i,functionName:a}=A(n.function),r=h(n.typeArguments);if(r.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${r.length}`);let o=n?.functionArguments?.map((c,s)=>R(n.function,e,c,s,r))??[];if(o.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${i}::${a}', expected ${e.parameters.length} but got ${o.length}`);return x.build(`${t}::${i}`,a,r,o)}function ln(n){return new H(new L(P.fromHexInput(n.bytecode).toUint8Array(),h(n.typeArguments),n.functionArguments))}async function hn(n){let{aptosConfig:e,sender:t,payload:i,options:a,feePayerAddress:r}=n,o=async()=>I[e.network]?{chainId:I[e.network]}:{chainId:(await en({aptosConfig:e})).chain_id},c=async()=>a?.gasUnitPrice?{gasEstimate:a.gasUnitPrice}:{gasEstimate:(await rn({aptosConfig:e})).gas_estimate},s=async()=>{let f=async()=>a?.accountSequenceNumber!==void 0?a.accountSequenceNumber:(await an({aptosConfig:e,accountAddress:t})).sequence_number;if(r&&u.from(r).equals(u.ZERO))try{return await f()}catch{return 0}else return f()},[{chainId:d},{gasEstimate:m},w]=await Promise.all([o(),c(),s()]),{maxGasAmount:mn,gasUnitPrice:yn,expireTimestamp:An}={maxGasAmount:a?.maxGasAmount?BigInt(a.maxGasAmount):BigInt(2e5),gasUnitPrice:a?.gasUnitPrice??BigInt(m),expireTimestamp:a?.expireTimestamp??BigInt(Math.floor(Date.now()/1e3)+20)};return new J(u.from(t),BigInt(w),i,BigInt(mn),BigInt(yn),BigInt(An),new q(d))}async function Xn(n){let{aptosConfig:e,sender:t,payload:i,options:a,feePayerAddress:r}=n,o=await hn({aptosConfig:e,sender:t,payload:i,options:a,feePayerAddress:r});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new tn(o,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new nn(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function zn(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:i,feePayerPublicKey:a}=n,r=T(e);if(t.feePayerAddress){let c=new Y(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];if(i&&(s=i.map(w=>T(w))),!a)throw new Error("Must provide a feePayerPublicKey argument to generate a signed fee payer transaction for simulation");let d=T(a),m=new D(r,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:d});return new y(c.raw_txn,m).bcsToBytes()}if(t.secondarySignerAddresses){let c=new Q(t.rawTransaction,t.secondarySignerAddresses),s=[];if(!i)throw new Error("Must provide a secondarySignersPublicKeys argument to generate a signed multi agent transaction for simulation");s=i.map(m=>T(m));let d=new F(r,t.secondarySignerAddresses,s);return new y(c.raw_txn,d).bcsToBytes()}let o;if(r instanceof p)o=new B(r.public_key,r.signature);else if(r instanceof l||r instanceof E)o=new M(r);else throw new Error("Invalid public key");return new y(t.rawTransaction,o).bcsToBytes()}function T(n){let t=S.isInstance(n)||v.isInstance(n)||N.isInstance(n)?new b(n):n,i=new K(new Uint8Array(64));if($.isInstance(t))return new p(t,i);if(b.isInstance(t))return S.isInstance(t.publicKey)?new l(t,new g(C.getSimulationSignature())):new l(t,new g(i));if(k.isInstance(t))return new E(t,new O({signatures:t.publicKeys.map(()=>new g(i)),bitmap:t.createBitmap({bits:Array(t.publicKeys.length).fill(0).map((a,r)=>r)})}));throw new Error("Unsupported PublicKey used for simulations")}function Tn(n){let{transaction:e,feePayerAuthenticator:t,additionalSignersAuthenticators:i}=n,a=U(V,n.senderAuthenticator),r;if(e.feePayerAddress){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");r=new D(a,e.secondarySignerAddresses??[],i??[],{address:e.feePayerAddress,authenticator:t})}else if(e.secondarySignerAddresses){if(!i)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");r=new F(a,e.secondarySignerAddresses,i)}else a instanceof p?r=new B(a.public_key,a.signature):r=new M(a);return new y(e.rawTransaction,r).bcsToBytes()}function un(n){let e=fn.create();for(let t of n)e.update(t);return e.digest()}var wn=un(["APTOS::Transaction"]);function Ln(n){let e=Tn(n);return new P(un([wn,new Uint8Array([0]),e])).toString()}async function dn({key:n,moduleAddress:e,moduleName:t,functionName:i,aptosConfig:a,abi:r,fetch:o}){return r!==void 0?r:_(async()=>o(e,t,i,a),`${n}-${a.network}-${e}-${t}-${i}`,1e3*60*5)()}export{qn as a,gn as b,Hn as c,pn as d,hn as e,Xn as f,zn as g,T as h,Tn as i,un as j,Ln as k};
//# sourceMappingURL=chunk-22ZSW5EN.mjs.map