import{a as j}from"./chunk-5S3Z7MT4.mjs";import{g}from"./chunk-Y267I7DC.mjs";import{a as S}from"./chunk-GLATLXF6.mjs";import{a as l}from"./chunk-M22UGFQ5.mjs";import{a as C}from"./chunk-BOWPP6YG.mjs";import{i as K,l as k,m as A,n as x,p as b}from"./chunk-FTZGP6XW.mjs";import{b as P}from"./chunk-OAEDFM7T.mjs";import{e as h,f as w}from"./chunk-2652SPOM.mjs";import{a as u}from"./chunk-IECDO22V.mjs";import{b as c}from"./chunk-KFNDDPOW.mjs";import{jwtDecode as E}from"jwt-decode";async function v(o){let{aptosConfig:s,jwt:i,ephemeralKeyPair:e,uidKey:a="sub",derivationPath:p}=o,t={jwt_b64:i,epk:e.getPublicKey().bcsToHex().toStringWithoutPrefix(),exp_date_secs:e.expiryDateSecs,epk_blinder:c.fromHexInput(e.blinder).toStringWithoutPrefix(),uid_key:a,derivation_path:p},{data:r}=await h({aptosConfig:s,path:"fetch",body:t,originMethod:"getPepper",overrides:{WITH_CREDENTIALS:!1}});return c.fromHexInput(r.pepper).toUint8Array()}async function _(o){let{aptosConfig:s,jwt:i,ephemeralKeyPair:e,pepper:a=await v(o),uidKey:p="sub"}=o;if(c.fromHexInput(a).toUint8Array().length!==l.PEPPER_LENGTH)throw new Error(`Pepper needs to be ${l.PEPPER_LENGTH} bytes`);let{maxExpHorizonSecs:t}=await b({aptosConfig:s}),r=E(i);if(typeof r.iat!="number")throw new Error("iat was not found");if(t<e.expiryDateSecs-r.iat)throw Error(`The EphemeralKeyPair is too long lived.  It's lifespan must be less than ${t}`);let n={jwt_b64:i,epk:e.getPublicKey().bcsToHex().toStringWithoutPrefix(),epk_blinder:c.fromHexInput(e.blinder).toStringWithoutPrefix(),exp_date_secs:e.expiryDateSecs,exp_horizon_secs:t,pepper:c.fromHexInput(a).toStringWithoutPrefix(),uid_key:p},{data:f}=await w({aptosConfig:s,path:"prove",body:n,originMethod:"getProof",overrides:{WITH_CREDENTIALS:!1}}),d=f.proof,y=new k({a:d.a,b:d.b,c:d.c});return new x({proof:new A(y,0),trainingWheelsSignature:P.fromHex(f.training_wheels_signature),expHorizonSecs:t})}async function O(o){let{aptosConfig:s,jwt:i,jwkAddress:e,uidKey:a,proofFetchCallback:p,pepper:t=await v(o)}=o,r=_({...o,pepper:t}),n=p?r:await r;if(e!==void 0){let y=C.fromJwtAndPepper({jwt:i,pepper:t,jwkAddress:e,uidKey:a}),m=await g({aptosConfig:s,authenticationKey:y.authKey().derivedAddress()});return S.create({...o,address:m,proof:n,pepper:t,proofFetchCallback:p,jwkAddress:e})}let f=K.fromJwtAndPepper({jwt:i,pepper:t,uidKey:a}),d=await g({aptosConfig:s,authenticationKey:f.authKey().derivedAddress()});return l.create({...o,address:d,proof:n,pepper:t,proofFetchCallback:p})}async function V(o){let{aptosConfig:s,sender:i,iss:e,options:a}=o,p=o.jwksUrl??(e.endsWith("/")?`${e}.well-known/jwks.json`:`${e}/.well-known/jwks.json`),t=await fetch(p);if(!t.ok)throw new Error(`Failed to fetch JWKS: ${t.status} ${t.statusText}`);let r=await t.json();return j({aptosConfig:s,sender:i.accountAddress,data:{function:"0x1::jwks::update_federated_jwk_set",functionArguments:[e,u.MoveString(r.keys.map(n=>n.kid)),u.MoveString(r.keys.map(n=>n.alg)),u.MoveString(r.keys.map(n=>n.e)),u.MoveString(r.keys.map(n=>n.n))]},options:a})}export{v as a,_ as b,O as c,V as d};
//# sourceMappingURL=chunk-BAGUHYFD.mjs.map